<h2>Affectation d'Engins</h2>

<form method="get">
  <label for="navire">Choisissez un navire :</label>
  <select name="navire_id" id="navire" onchange="this.form.submit()">
    <option value="">-- Sélectionner --</option>
    {% for navire in navires %}
      <option value="{{ navire.id }}" {% if navire.id|stringformat:"s" == selected_navire_id %}selected{% endif %}>
        {{ navire.nom }} ({{ navire.type_marchandise }})
      </option>
    {% endfor %}
  </select>
</form>

{% if marchandise %}
  <h3>Marchandise du navire : {{ marchandise }}</h3>
  <h4>Engins disponibles :</h4>
  <ul>
    {% for engin in engins %}
      <li>{{ engin.matricule }} - {{ engin.marque }} {{ engin.modele }} ({{ engin.type_engin }})</li>
    {% empty %}
      <li>Aucun engin disponible pour cette marchandise.</li>
    {% endfor %}
  </ul>
{% endif %}

<form method="post">
    {% csrf_token %}
    <label for="nombre_engins">Nombre d'engins à affecter :</label>
    <input type="number" name="nombre_engins" id="nombre_engins" min="1" required>

    <input type="hidden" name="navire_id" value="{{ selected_navire_id }}">
    
    <button type="submit">Affecter automatiquement</button>
</form>


{% if messages %}
  <ul class="messages">
    {% for message in messages %}
      <li {% if message.tags %} class="{{ message.tags }}" {% endif %}>{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}


{% if chauffeurs %}
  <h4>Chauffeurs disponibles :</h4>
  <ul>
    {% for chauffeur in chauffeurs %}
      <li>{{ chauffeur.firstname }} {{ chauffeur.lastname }} - {{ chauffeur.matricule }}</li>
    {% endfor %}
  </ul>
{% endif %}



<button onclick="location.href='{% url 'chef_escale' %}'" class="btn btn-primary">
    Retour à l'accueil
</button>